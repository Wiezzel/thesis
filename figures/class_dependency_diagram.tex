\tikzumlset{fill class=white,font=\footnotesize}
\begin{tikzpicture}
\begin{umlpackage}[fill=gray!10,draw=gray!10]{pl{.}edu{.}mimuw{.}changeanalyzer}

\umlsimpleclass[x=1ex,y=1ex]{ChangeAnalyzerOptionParser}
\umlsimpleclass[right=1em of ChangeAnalyzerOptionParser]{ChangeAnalyzer}
\umlsimpleclass[right=1em of ChangeAnalyzer]{ExtractAndSave}

\begin{umlpackage}[fill=gray!30,draw=gray!30]{extraction}
\umlsimpleclass[below right=2.15em and 0.35em of ChangeAnalyzerOptionParser.south west,anchor=north west]{ClassHistoryWrapper}
\umlsimpleclass[right=2em of ClassHistoryWrapper]{ClassHistoryExtractor}
\umlsimpleclass[right=1em of ClassHistoryExtractor]{CommitInfo}
\umlsimpleclass[right=1em of CommitInfo]{ExtractionUtils}
\umlsimpleclass[right=1em of ExtractionUtils]{AuthorInfo}

\umlsimpleclass[below=2em of ClassHistoryWrapper.south west,anchor=north west]{MethodHistoryIterator}
\umlsimpleclass[below=2em of ClassHistoryExtractor.south west,anchor=north west]{RepoHistoryExtractor}
\umlsimpleclass[below=2em of CommitInfo.south west,anchor=north west]{CommitInfoExtractor}
\umlsimpleclass[right=1em of CommitInfoExtractor]{AuthorInfoExtractor}

\umlVHVcompo[arm2=1em,anchor1=north]{RepoHistoryExtractor}{ClassHistoryExtractor}
\umlVHVcompo[arm2=1em,anchor1=south]{ClassHistoryWrapper}{MethodHistoryIterator}
\end{umlpackage}

\begin{umlpackage}[fill=gray!30,draw=gray!30]{models}
\umlsimpleclass[below=2.50em of MethodHistoryIterator.south west,anchor=north west,font=\it\footnotesize]{DataSetProcessor}
\umlsimpleclass[right=2.50em of DataSetProcessor]{DataSetProvider}
\umlsimpleclass[right=2.50em of DataSetProvider,font=\it\footnotesize]{DataSetBuilder}
\umlsimpleclass[right=2.50em of DataSetBuilder]{ChangeCounter}

\umlsimpleclass[below=2em of DataSetProcessor.south west,anchor=north west]{DefaultDataSetProcessor}
\umlsimpleclass[right=2.50em of DefaultDataSetProcessor]{ReadOnlyDataSetProvider}
\umlsimpleclass[right=1em of ReadOnlyDataSetProvider,font=\it\footnotesize]{ChunkDataSetBuilder}

\node[draw=none] (ca-dsp) [below left=1.25em and 0.50em of RepoHistoryExtractor.south west,anchor=north] {};

\umlVHVcompo[arm1=-1.25em,anchor1=south,anchor2=north]{ChangeAnalyzer}{ca-dsp}
\umlassoc[geometry=-|,anchors=north and 150]{ca-dsp}{DataSetProvider}
\umlVHVcompo[arm2=1em,anchors=30 and south]{DataSetProvider}{RepoHistoryExtractor}
\umlcompo[]{DataSetProvider}{DataSetProcessor}
\umlcompo[]{DataSetProvider}{DataSetBuilder}
\umlVHVcompo[arm1=1.25em,anchors=145 and -155]{DataSetBuilder}{CommitInfoExtractor}
\umlVHVcompo[arm1=1.25em,anchors=35 and south]{DataSetBuilder}{AuthorInfoExtractor}
\umlcompo{DataSetBuilder}{ChangeCounter}
\umlVHVimpl[arm1=1em,anchor2=-145]{DefaultDataSetProcessor}{DataSetProcessor}
\umlcompo{ReadOnlyDataSetProvider}{DefaultDataSetProcessor}
\umlVHVinherit[anchor2=-30]{ReadOnlyDataSetProvider}{DataSetProvider}
\umlVHVinherit[anchor2=-35]{ChunkDataSetBuilder}{DataSetBuilder}

\begin{umlpackage}[fill=gray!50,draw=gray!50]{standard}
\umlsimpleclass[below right=2.15em and 0.35em of DefaultDataSetProcessor.south west,anchor=north west]{StandardDataSetProcessor}
\umlsimpleclass[below=2.15em of ReadOnlyDataSetProvider.south west,anchor=north west]{StandardDataSetProvider}
\umlsimpleclass[below=2.15em of ChunkDataSetBuilder.south west,anchor=north west]{StandardDataSetBuilder}
\end{umlpackage}

\node[draw=none] (sdsp-dsp) [above right=1em and 0.35em of DefaultDataSetProcessor.north east, anchor=south] {};

\umlVHVassoc[arm1=1em,anchor1=north,anchor2=south,style=dashed]{StandardDataSetProcessor}{sdsp-dsp}
\umlimpl[geometry=-|,anchor1=south,anchor2=-35]{sdsp-dsp}{DataSetProcessor}
\umlVHVinherit[arm1=1em,anchor1=north,anchor2=-150]{StandardDataSetProvider}{DataSetProvider}
\umlVHVinherit[arm1=1em]{StandardDataSetBuilder}{ChunkDataSetBuilder}

\begin{umlpackage}[fill=gray!50,draw=gray!50]{attributes}
\umlsimpleclass[below=7.25em of StandardDataSetProcessor.south west,anchor=north west]{SumAttributes}
\umlsimpleclass[right=1em of SumAttributes]{DeleteAttributes}
\umlsimpleclass[right=1em of DeleteAttributes]{ReorderClassAttribute}

\umlsimpleclass[above=2.50em of DeleteAttributes,font=\it\footnotesize]{AttributeProcessor}
\umlsimpleclass[above=2.50em of ReorderClassAttribute.north east,anchor=south east]{Attributes}
\end{umlpackage}

\umlVHVimpl[arm1=1em,anchor1=north,anchor2=-150]{SumAttributes}{AttributeProcessor}
\umlimpl{DeleteAttributes}{AttributeProcessor}
\umlVHVimpl[arm1=1em,anchor1=north,anchor2=-30]{ReorderClassAttribute}{AttributeProcessor}
\umlVHVcompo[arm1=-1em,anchor1=-145,anchor2=60]{DataSetBuilder}{Attributes}

\begin{umlpackage}[fill=gray!50,draw=gray!50]{measures}
\umlsimpleclass[below=6.75em of SumAttributes.south west,anchor=north west]{LinearMeasure}
\umlsimpleclass[right=1em of LinearMeasure]{GeometricMeasure}
\umlsimpleclass[right=1em of GeometricMeasure]{WeightedMeasure}

\umlsimpleclass[above=2em of GeometricMeasure,font=\it\footnotesize]{BugPronenessMeasure}

\umlVHVimpl[arm1=1em,anchor1=north,anchor2=-155]{LinearMeasure}{BugPronenessMeasure}
\umlimpl{GeometricMeasure}{BugPronenessMeasure}
\umlVHVimpl[arm1=1em,anchor1=north,anchor2=-25]{WeightedMeasure}{BugPronenessMeasure}
\end{umlpackage}
\end{umlpackage}

\begin{umlpackage}[fill=gray!30,draw=gray!30]{exceptions}
\umlsimpleclass[below left=7.10em and 0.35em of LinearMeasure.south west,anchor=north west]{ExtractionException}
\umlsimpleclass[right=1em of ExtractionException]{DataSetBuilderException}
\umlsimpleclass[right=1em of DataSetBuilderException]{ProcessingException}
\umlsimpleclass[right=1em of ProcessingException]{PredictionException}

\umlsimpleclass[above right=2em and 0.50em of DataSetBuilderException.north east,anchor=south]{ChangeAnalyzerException}

\umlinherit[geometry=|-,anchor2=west]{ExtractionException}{ChangeAnalyzerException}
\umlVHVinherit[anchor2=-150]{DataSetBuilderException}{ChangeAnalyzerException}
\umlVHVinherit[anchor2=-30]{ProcessingException}{ChangeAnalyzerException}
\umlinherit[geometry=|-,anchor2=east]{PredictionException}{ChangeAnalyzerException}
\end{umlpackage}

\begin{umlpackage}[fill=gray!30,draw=gray!30]{util}
\umlsimpleclass[below=2.50em of ExtractionException.south west,anchor=north west]{LazyList<T>}
\umlsimpleclass[right=2.50em of LazyList<T>]{LazyIterator}

\umlcompo{LazyList<T>}{LazyIterator}
\end{umlpackage}
\end{umlpackage}
\end{tikzpicture}